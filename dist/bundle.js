!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=22)}([function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,r){var n=r(19);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,r){var n=r(20),i=r(4);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},function(t,e,r){var n=r(14),i=r(15),o=r(16),a=r(18);t.exports=function(t,e){return n(t)||i(t,e)||o(t,e)||a()}},function(t,e,r){var n=r(21);function i(e,r,o){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=i=Reflect.get:t.exports=i=function(t,e,r){var i=n(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(r):o.value}},i(e,r,o||e)}t.exports=i},function(t,e,r){t.exports=r(13)},function(t,e){function r(t,e,r,n,i,o,a){try{var u=t[o](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function u(t){r(a,i,o,u,c,"next",t)}function c(t){r(a,i,o,u,c,"throw",t)}u(void 0)}))}}},function(t,e){t.exports="attribute vec4 a_position;\r\nattribute vec4 a_color;\r\nattribute vec2 a_texcoord;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texcoord;\r\nvarying vec4 v_position;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n\r\n    v_color = a_color;\r\n    v_texcoord=a_texcoord;\r\n    v_position=gl_Position;\r\n}"},function(t,e){t.exports="// fragment shaders don't have a default precision so we need\r\n// to pick one. mediump is a good default\r\nprecision mediump float;\r\n\r\nuniform int u_useTexture;\r\nuniform sampler2D u_texture;\r\n\r\nvarying vec4 v_color;\r\nvarying vec4 v_position;\r\nvarying vec2 v_texcoord;\r\nvoid main() {\r\n    if (u_useTexture==0){\r\n        gl_FragColor = v_color;\r\n    }else if (u_useTexture==1){\r\n        gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    }else{\r\n        gl_FragColor =0.0*vec4(.15,.0,.0,.0)+texture2D(u_texture, 0.5*(v_position.xy/v_position.w)+0.5);\r\n    }\r\n}"},function(t,e,r){var n=function(t){"use strict";var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,e,r,n){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new _(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return T()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var u=b(a,r);if(u){if(u===s)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var f=c(t,e,r);if("normal"===f.type){if(n=r.done?"completed":"suspendedYield",f.arg===s)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(n="completed",r.method="throw",r.arg=f.arg)}}}(t,r,a),o}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var s={};function f(){}function h(){}function l(){}var p={};p[i]=function(){return this};var d=Object.getPrototypeOf,v=d&&d(d(R([])));v&&v!==e&&r.call(v,i)&&(p=v);var m=l.prototype=f.prototype=Object.create(p);function y(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function g(t,e){var n;this._invoke=function(i,o){function a(){return new e((function(n,a){!function n(i,o,a,u){var s=c(t[i],t,o);if("throw"!==s.type){var f=s.arg,h=f.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):e.resolve(h).then((function(t){f.value=t,a(f)}),(function(t){return n("throw",t,a,u)}))}u(s.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return s;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,s;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function R(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return h.prototype=m.constructor=l,l.constructor=h,l[a]=h.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},y(g.prototype),g.prototype[o]=function(){return this},t.AsyncIterator=g,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new g(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(m),m[a]="Generator",m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=R,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:R(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}}},function(t,e,r){var n=r(17);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e,r){var n=r(0);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e,r){"use strict";r.r(e);var n=r(9),i=r.n(n),o=r(10),a=r.n(o);function u(t,e){var r=[],n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],c=e[5],s=e[6],f=e[7],h=e[8],l=e[9],p=e[10],d=e[11],v=e[12],m=e[13],y=e[14],g=e[15],b=t[0],x=t[1],E=t[2],_=t[3],R=t[4],T=t[5],w=t[6],M=t[7],P=t[8],A=t[9],F=t[10],L=t[11],S=t[12],O=t[13],j=t[14],k=t[15];return r[0]=n*b+i*R+o*P+a*S,r[1]=n*x+i*T+o*A+a*O,r[2]=n*E+i*w+o*F+a*j,r[3]=n*_+i*M+o*L+a*k,r[4]=u*b+c*R+s*P+f*S,r[5]=u*x+c*T+s*A+f*O,r[6]=u*E+c*w+s*F+f*j,r[7]=u*_+c*M+s*L+f*k,r[8]=h*b+l*R+p*P+d*S,r[9]=h*x+l*T+p*A+d*O,r[10]=h*E+l*w+p*F+d*j,r[11]=h*_+l*M+p*L+d*k,r[12]=v*b+m*R+y*P+g*S,r[13]=v*x+m*T+y*A+g*O,r[14]=v*E+m*w+y*F+g*j,r[15]=v*_+m*M+y*L+g*k,r}function c(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],u=t[6],c=t[7],s=t[8],f=t[9],h=t[10],l=t[11],p=t[12],d=t[13],v=t[14],m=t[15],y=h*m,g=v*l,b=u*m,x=v*c,E=u*l,_=h*c,R=n*m,T=v*i,w=n*l,M=h*i,P=n*c,A=u*i,F=s*d,L=p*f,S=o*d,O=p*a,j=o*f,k=s*a,U=e*d,D=p*r,B=e*f,I=s*r,X=e*a,Y=o*r,C=y*a+x*f+E*d-(g*a+b*f+_*d),N=g*r+R*f+M*d-(y*r+T*f+w*d),G=b*r+T*a+P*d-(x*r+R*a+A*d),q=_*r+w*a+A*f-(E*r+M*a+P*f),W=1/(e*C+o*N+s*G+p*q);return[W*C,W*N,W*G,W*q,W*(g*o+b*s+_*p-(y*o+x*s+E*p)),W*(y*e+T*s+w*p-(g*e+R*s+M*p)),W*(x*e+R*o+A*p-(b*e+T*o+P*p)),W*(E*e+M*o+P*s-(_*e+w*o+A*s)),W*(F*c+O*l+j*m-(L*c+S*l+k*m)),W*(L*i+U*l+I*m-(F*i+D*l+B*m)),W*(S*i+D*c+X*m-(O*i+U*c+Y*m)),W*(k*i+B*c+Y*l-(j*i+I*c+X*l)),W*(S*h+k*v+L*u-(j*v+F*u+O*h)),W*(B*v+F*n+D*h-(U*h+I*v+L*n)),W*(U*u+Y*v+O*n-(X*v+S*n+D*u)),W*(X*h+j*n+I*u-(B*u+Y*h+k*n))]}var s=function(t,e,r,n){return u(t,function(t,e,r){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1]}(e,r,n))},f=function(t,e){return u(t,(r=e,n=Math.cos(r),i=Math.sin(r),[1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1]));var r,n,i},h=function(t,e){return u(t,(r=e,n=Math.cos(r),i=Math.sin(r),[n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1]));var r,n,i},l=function(t,e){return u(t,(r=e,n=Math.cos(r),i=Math.sin(r),[n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1]));var r,n,i},p=function(t,e,r,n){return u(t,function(t,e,r){return[t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1]}(e,r,n))},d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function v(t,e,r){r=r||[0,0,0,0];for(var n=0;n<4;++n){r[n]=0;for(var i=0;i<4;++i)r[n]+=e[i]*t[4*i+n]}return r}var m=r(2),y=r.n(m),g=r(3),b=r.n(g),x=r(1),E=r.n(x);function _(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))return n;console.log(t.getShaderInfoLog(n)),t.deleteShader(n)}var R=r(11),T=r.n(R),w=r(12),M=r.n(w),P=function(){function t(e){y()(this,t),this.keymap={},this.mouseX=0,this.mouseY=0,this.keydown=this.keydown.bind(this),this.keyup=this.keyup.bind(this),this.mousemove=this.mousemove.bind(this),this.readMouseMove=this.readMouseMove.bind(this),document.body.addEventListener("keyup",this.keyup,!1),document.body.addEventListener("keydown",this.keydown,!1),e.addEventListener("mousemove",this.mousemove,!1),e.addEventListener("click",(function(t){e.requestPointerLock(),e.focus(),t.preventDefault()}),!1)}return b()(t,[{key:"keydown",value:function(t){this.keymap[t.key]=!0}},{key:"keyup",value:function(t){this.keymap[t.key]=!1}},{key:"mousemove",value:function(t){this.mouseX+=t.movementX,this.mouseY+=t.movementY}},{key:"readKeymap",value:function(){return this.keymap}},{key:"readMouseMove",value:function(){var t=[this.mouseX,this.mouseY];return this.mouseX=0,this.mouseY=0,t}}]),t}(),A=function(){function t(e,r){if(y()(this,t),E()(this,"objects",[]),E()(this,"farCutoff",30),E()(this,"animationManager",null),E()(this,"buffers",new WeakMap),E()(this,"cameraMatrix",void 0),this.draw=this.draw.bind(this),this.drawLoop=this.drawLoop.bind(this),this.drawObject=this.drawObject.bind(this),this.addObject=this.addObject.bind(this),this.gl=e,r)this.input=r.input,this.defaultProgram=r.defaultProgram;else{this.input=new P(e.canvas),function(t,e){e=e||1;var r=t.clientWidth*e|0,n=t.clientHeight*e|0;(t.width!==r||t.height!==n)&&(t.width=r,t.height=n)}(e.canvas,2),e.viewport(0,0,e.canvas.width,e.canvas.height);var n=_(e,e.VERTEX_SHADER,T.a),i=_(e,e.FRAGMENT_SHADER,M.a);e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),this.defaultProgram=function(t,e,r){var n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;t.deleteProgram(n)}(e,n,i),e.useProgram(this.defaultProgram)}this.matrixLocation=e.getUniformLocation(this.defaultProgram,"u_matrix"),this.textureLocation=e.getUniformLocation(this.defaultProgram,"u_texture"),this.textureFlagLocation=e.getUniformLocation(this.defaultProgram,"u_useTexture"),this.positionLocation=e.getAttribLocation(this.defaultProgram,"a_position"),this.colorLocation=e.getAttribLocation(this.defaultProgram,"a_color"),this.textureMapLocation=e.getAttribLocation(this.defaultProgram,"a_texcoord");var o=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight;this.perspectiveMatrix=function(t,e,r,n){var i=Math.tan(.5*Math.PI-.5*t),o=1/(r-n);return[i/e,0,0,0,0,i,0,0,0,0,(r+n)*o,-1,0,0,r*n*o*2,0]}(Math.PI/4,o,5e-4,this.farCutoff)}return b()(t,[{key:"addObject",value:function(t){t.init(this),this.objects.push(t)}},{key:"drawLoop",value:function(t){if(this.animationManager&&this.animationManager.update(this,t))return;this.draw(),requestAnimationFrame(this.drawLoop)}},{key:"draw",value:function(){this.projectionMatrix=u(this.perspectiveMatrix,this.cameraMatrix);var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);for(var e=0;e<this.objects.length;e++){this.objects[e].draw(this)}}},{key:"drawObject",value:function(t){var e=this.gl,r=this.buffers.get(t);if(this.cameraMatrix){var n=v(this.cameraMatrix,[t.transformationMatrix[12],t.transformationMatrix[13],t.transformationMatrix[14],1]);if(n[0]*n[0]+n[1]*n[1]+n[3]*n[3]>Math.pow(this.farCutoff,2))return}var i=u(this.projectionMatrix,t.transformationMatrix);e.uniformMatrix4fv(this.matrixLocation,!1,i),e.uniform1i(this.textureLocation,0),e.bindBuffer(e.ARRAY_BUFFER,r.positionBuffer),e.enableVertexAttribArray(this.positionLocation),e.vertexAttribPointer(this.positionLocation,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,r.textureMapBuffer),e.enableVertexAttribArray(this.textureMapLocation),e.vertexAttribPointer(this.textureMapLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,r.colorBuffer),e.enableVertexAttribArray(this.colorLocation),e.vertexAttribPointer(this.colorLocation,3,e.FLOAT,!1,0,0),e.drawArrays(e[t.drawMode],0,t.vertices.length)}},{key:"registerAnimationManager",value:function(t){this.animationManager=t,t.init(this)}}]),t}(),F=r(7),L=r.n(F),S=r(5),O=r.n(S),j=r(6),k=r.n(j),U=r(0),D=r.n(U),B=r(4),I=r.n(B),X=r(8),Y=r.n(X);function C(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function N(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var G=function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(N()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(t){var e;return y()(this,n),e=r.call(this),E()(I()(e),"textureMap",[]),E()(I()(e),"typeFlag",1),e.texture=t,e}return b()(n,[{key:"draw",value:function(t){if(!this.lock){this.lock=!0;var e=t.gl.getUniform(t.defaultProgram,t.textureFlagLocation);t.gl.uniform1i(t.textureFlagLocation,this.typeFlag),this.texture.enable(t),t.drawObject(this),t.gl.uniform1i(t.textureFlagLocation,e),this.lock=!1,t.gl.bindTexture(t.gl.TEXTURE_2D,null)}}},{key:"init",value:function(t){Y()(D()(n.prototype),"init",this).call(this,t),this.texture.init(t)}}]),n}(function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(C()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(){var t;return y()(this,n),t=r.call(this),E()(I()(t),"drawMode","TRIANGLES"),t}return b()(n,[{key:"draw",value:function(t){var e=t.gl.getUniform(t.defaultProgram,t.textureFlagLocation);t.gl.uniform1i(t.textureFlagLocation,this.typeFlag),t.drawObject(this),t.gl.uniform1i(t.textureFlagLocation,e)}}]),n}(function(){function t(){y()(this,t),E()(this,"vertices",[]),E()(this,"colors",[]),E()(this,"textureMap",[]),E()(this,"transformationMatrix",d),E()(this,"drawMode","unknown"),E()(this,"typeFlag",0),this.colorAllFaces=this.colorAllFaces.bind(this),this.draw=this.draw.bind(this),this.init=this.init.bind(this),this.translate=this.translate.bind(this),this.rotateX=this.rotateX.bind(this),this.rotateY=this.rotateY.bind(this),this.rotateZ=this.rotateZ.bind(this),this.scale=this.scale.bind(this)}return b()(t,[{key:"colorAllFaces",value:function(t){this.colors=[];for(var e=0;e<this.vertices.length;e++)this.colors=this.colors.concat(t);this.colors=new Float32Array(this.colors)}},{key:"draw",value:function(t){t.drawObject(this)}},{key:"init",value:function(t){var e=t.gl,r={};r.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.positionBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW),r.colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),r.textureMapBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.textureMapBuffer),e.bufferData(e.ARRAY_BUFFER,this.textureMap,e.STATIC_DRAW),t.buffers.set(this,r)}},{key:"translate",value:function(t,e,r){this.transformationMatrix=u(s(d,t,e,r),this.transformationMatrix)}},{key:"rotateX",value:function(t){this.transformationMatrix=u(f(d,t),this.transformationMatrix)}},{key:"rotateY",value:function(t){this.transformationMatrix=u(h(d,t),this.transformationMatrix)}},{key:"rotateZ",value:function(t){this.transformationMatrix=u(l(d,t),this.transformationMatrix)}},{key:"scale",value:function(t,e,r){this.transformationMatrix=u(p(d,t,e,r),this.transformationMatrix)}}]),t}()));function q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var W=function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(q()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(t,e,i){var o;y()(this,n),o=r.call(this,e);var a=function(t,e){var r=t.split("\n"),n=0,i=[],o=[],a=[],u=[];for(;"v "!==r[n].substr(0,2);)n++;for(;"v "===r[n].substr(0,2);)i.push(r[n].substr(2).split(" ").map((function(t){return parseFloat(t)*e}))),n++;for(;"vt "!==r[n].substr(0,3);)n++;for(;"vt "===r[n].substr(0,3);){var c=r[n].substr(3).split(" ").map((function(t){return parseFloat(t)})).slice(0,2),s=c[0],f=1-c[1];o.push([s,f]),n++}for(;"f "!==r[n].substr(0,2);)n++;for(;"f "===r[n].substr(0,2);){var h=r[n].substr(2).split(" ").map((function(t){return t.split("/")})),l=[h[0][0],h[1][0],h[2][0]].map((function(t){return i[parseInt(t)-1]})).flat(),p=[h[0][1],h[1][1],h[2][1]].map((function(t){return o[parseInt(t)-1]})).flat();l.map((function(t){return a.push(t)})),p.map((function(t){return u.push(t)})),n++}return[a,u]}(t,i=i||.001),u=L()(a,2);return o.vertices=u[0],o.textureMap=u[1],o.vertices=new Float32Array(o.vertices),o.textureMap=new Float32Array(o.textureMap),o}return n}(G);var H=function(){function t(){y()(this,t),this.enable=this.enable.bind(this),this.init=this.init.bind(this)}return b()(t,[{key:"init",value:function(t){}},{key:"enable",value:function(t){}}]),t}();function Z(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var Q=function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(Z()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(t){var e;return y()(this,n),(e=r.call(this)).url=t,e}return b()(n,[{key:"init",value:function(t){var e=function(t,e){var r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);var n=t.RGBA,i=t.RGBA,o=t.UNSIGNED_BYTE,a=new Uint8Array([255,255,255,255]);t.texImage2D(t.TEXTURE_2D,0,n,1,1,0,i,o,a);var u=new Image;return u.onload=function(){t.bindTexture(t.TEXTURE_2D,r);var e=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(e){var a=t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT);t.texParameterf(t.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,a)}t.texImage2D(t.TEXTURE_2D,0,n,i,o,u),K(u.width)&&K(u.height)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))},u.src=e,r}(t.gl,this.url);t.buffers.set(this,e)}},{key:"enable",value:function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,t.buffers.get(this))}}]),n}(H);function K(t){return 0==(t&t-1)}function V(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var $=function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(V()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(){var t;y()(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=r.call.apply(r,[this].concat(i)),E()(I()(t),"typeFlag",2),t}return n}(G);function z(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var J=function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(z()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(t){var e;return y()(this,n),(e=r.call(this)).targetScene=t,e.cameraMatrix=void 0,e.update=e.update.bind(I()(e)),e.bindFrameBuffer=e.bindFrameBuffer.bind(I()(e)),e.unbindFrameBuffer=e.unbindFrameBuffer.bind(I()(e)),e}return b()(n,[{key:"init",value:function(t){this.cameraMatrix=t.cameraMatrix;var e=t.gl,r=e.canvas.width,n=e.canvas.height,i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);var o=e.RGBA,a=e.RGBA,u=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,0,o,r,n,0,a,u,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var c=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,c);var s=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,s),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r,n),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,s);var f=e.COLOR_ATTACHMENT0;e.framebufferTexture2D(e.FRAMEBUFFER,f,e.TEXTURE_2D,i,0),t.buffers.set(this,{texture:i,frameBuffer:c,depthBuffer:s}),e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"enable",value:function(t){if(!this.lock){var e=t.buffers.get(this),r=t.gl;r.bindTexture(r.TEXTURE_2D,e.texture)}}},{key:"bindFrameBuffer",value:function(t){var e=t.buffers.get(this).frameBuffer,r=t.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),tt.push(e)}},{key:"unbindFrameBuffer",value:function(t){var e=t.gl;tt.pop();var r=tt.pop();e.bindFramebuffer(e.FRAMEBUFFER,r),tt.push(r)}},{key:"update",value:function(){if(!this.lock){if(this.lock=!0,this.cameraMatrix){var t=this.targetScene.cameraMatrix,e=this.targetScene.projectionMatrix;this.targetScene.cameraMatrix=this.cameraMatrix,this.targetScene.projectionMatrix=u(this.targetScene.perspectiveMatrix,this.cameraMatrix),this.targetScene.draw(),this.targetScene.cameraMatrix=t,this.targetScene.projectionMatrix=e}else this.targetScene.draw();this.lock=!1}}}]),n}(H),tt=[];function et(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var rt=function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(et()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(t,e,i){var o;y()(this,n);var a=new J(i||t);return(o=r.call(this,a)).textureScene=i||t,o.texture=a,e=e||d,o.vertices=new Float32Array([0,0,0,2,0,0,0,2,0,2,2,0,0,2,0,2,0,0]),o.targetLocation=e,o.forceRender=!1,o.id=Math.floor(1e5*Math.random()),o}return b()(n,[{key:"init",value:function(t){Y()(D()(n.prototype),"init",this).call(this,t)}},{key:"draw",value:function(t){if(!this.lock){it.push(this.id);var e=t.gl;this.texture.cameraMatrix=u(u(t.cameraMatrix,this.transformationMatrix),c(this.targetLocation)),this.lock=!0;var r,i,o=function(t){var e=it.reduce((function(t,e){return 10*t+e}),0);if(ot[e])return ot[e];var r={};return r.query=t.createQuery(),r.queryInProgress=!1,r}(e);(function(t,e){var r=!0;t.queryInProgress&&e.getQueryParameter(t.query,e.QUERY_RESULT_AVAILABLE)&&(r=!e.getQueryParameter(t.query,e.QUERY_RESULT),t.queryInProgress=!1);return r})(o,e)&&!this.forceRender||(this.texture.bindFrameBuffer(t),function(t){t.clear(t.STENCIL_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT),t.enable(t.STENCIL_TEST),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),t.stencilFunc(t.ALWAYS,1,255),t.stencilMask(255)}(e),function(t,e){var r=t.textureScene.projectionMatrix;t.textureScene.projectionMatrix=e.projectionMatrix,t.textureScene.drawObject(t),t.textureScene.projectionMatrix=r}(this,t),function(t){t.stencilFunc(t.EQUAL,1,255),t.stencilMask(0),nt.push(!0)}(e),this.texture.update(),function(t){t.clear(t.STENCIL_BUFFER_BIT),nt.pop();var e=nt.pop();t.disable(t.STENCIL_TEST),e&&t.enable(t.STENCIL_TEST);nt.push(e)}(e),this.texture.unbindFrameBuffer(t)),this.lock=!1,o.queryInProgress?Y()(D()(n.prototype),"draw",this).call(this,t):(e.beginQuery(e.ANY_SAMPLES_PASSED,o.query),Y()(D()(n.prototype),"draw",this).call(this,t),e.endQuery(e.ANY_SAMPLES_PASSED),o.queryInProgress=!0),r=o,i=it.reduce((function(t,e){return 10*t+e}),0),ot[i]=r,it.pop()}}}]),n}($);var nt=[],it=[],ot={};function at(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var ut=function(t){O()(n,t);var e,r=(e=n,function(){var t,r=D()(e);if(at()){var n=D()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return k()(this,t)});function n(){var t;y()(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=r.call.apply(r,[this].concat(i)),E()(I()(t),"cameraX",0),E()(I()(t),"cameraY",1),E()(I()(t),"cameraZ",4),E()(I()(t),"cameraYaw",0),E()(I()(t),"cameraPitch",0),E()(I()(t),"movementSpeed",1.9),E()(I()(t),"portals",null),t}return b()(n,[{key:"update",value:function(t,e){var r=this,n=t.objects.filter((function(t){return t.targetLocation})).filter((function(t){var e=v(c(t.transformationMatrix),[r.cameraX,r.cameraY,r.cameraZ,1]);return ct(e)&&e[2]>=0}));this.oldTime||(this.oldTime=0);var i=e-this.oldTime;this.oldTime=e,t.objects.map((function(t){return t.update&&t.update(e,i)}));var o=t.input.readMouseMove(),a=L()(o,2),l=a[0],p=a[1],m=t.input.readKeymap(),y=0,g=0;m.w&&(y-=i/1e3*this.movementSpeed),m.s&&(y+=i/1e3*this.movementSpeed),m.a&&(g-=i/1e3*this.movementSpeed),m.d&&(g+=i/1e3*this.movementSpeed);var b=function(t){return t<-Math.PI?t+2*Math.PI:t>Math.PI?t-2*Math.PI:t};this.cameraYaw=b(this.cameraYaw-l/1200),this.cameraPitch=b(this.cameraPitch-p/1200),this.cameraPitch=this.cameraPitch>Math.PI/2.2?Math.PI/2.2:this.cameraPitch,this.cameraPitch=this.cameraPitch<-Math.PI/2.2?-Math.PI/2.2:this.cameraPitch;var x=v(f(h(d,this.cameraYaw),this.cameraPitch),[g,0,y,1]);this.cameraX+=x[0],this.cameraY+=x[1],this.cameraZ+=x[2];for(var E=0;E<n.length;E++){var _=n[E],R=c(_.transformationMatrix),T=v(R,[this.cameraX,this.cameraY,this.cameraZ,1]);if(ct(T)&&T[2]<0){var w=v(u(_.targetLocation,R),[this.cameraX,this.cameraY,this.cameraZ,1]),M=L()(w,3);this.cameraX=M[0],this.cameraY=M[1],this.cameraZ=M[2];var P=v(u(_.targetLocation,R),[0,0,1,0]),A=L()(P,3),F=A[0],S=(A[1],A[2]);this.cameraYaw+=Math.atan2(F,S);break}}return t.cameraMatrix=c(u(s(d,this.cameraX,this.cameraY,this.cameraZ),f(h(d,this.cameraYaw),this.cameraPitch))),!1}}]),n}(function(){function t(){y()(this,t),this.update=this.update.bind(this),this.init=this.init.bind(this)}return b()(t,[{key:"init",value:function(t){}},{key:"update",value:function(t,e){return!1}}]),t}());function ct(t){return t[0]>=0&&t[0]<=2&&t[1]>=0&&t[1]<=2&&t[2]<=.2}function st(){return(st=a()(i.a.mark((function t(){var e,r,n,o,a,u,c,f,h,l,v,m,y,g;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=document.querySelector("#canvas"),r=e.getContext("webgl2",{stencil:!0}),n=new A(r),o=new A(r,n),a=new A(r,n),u=new ut,n.registerAnimationManager(u),t.next=9,ht("island3.obj","island3Color.png",2);case 9:return c=t.sent,n.addObject(c),o.addObject(c),c.translate(10,-3,3),t.next=15,ht("island2.obj","island2Color.png",2.5);case 15:return f=t.sent,n.addObject(f),f.translate(0,0,0),t.next=20,ht("insideIsland2.obj","island2Color.png",2.5);case 20:return h=t.sent,o.addObject(h),h.translate(0,0,0),t.next=25,ht("island1","island1Color.png",2);case 25:return(l=t.sent).translate(-5,3,-3),n.addObject(l),o.addObject(l),t.next=31,ht("rooms.obj","roomColor.png",.5);case 31:return v=t.sent,n.addObject(v),o.addObject(v),t.next=36,ht("star1.obj","star1.png",.5);case 36:return m=t.sent,n.addObject(m),o.addObject(m),m.translate(0,50,0),v.translate(0,50,0),t.next=43,ht("rooms.obj","roomColor.png",.5);case 43:return y=t.sent,n.addObject(y),a.addObject(y),t.next=48,ht("star2.obj","star2.png",.5);case 48:g=t.sent,n.addObject(g),a.addObject(g),g.translate(0,-50,0),y.translate(0,-50,0),n.drawLoop(),.83,1.47,.2,ft(n,p(s(d,.398,-.01,4.62),-.25,.3,-.25),n,p(s(d,-4.95,3,-3),.2075,.3*.83,.2075),n,n),ft(o,p(s(d,.398,-.01,4.62),-.25,.3,-.25),o,p(s(d,-4.95,3,-3),.2075,.3*.83,.2075),o,o),ft(n,p(s(d,0,0,-.4),.265,.265,.265),n,p(s(d,0,0,-4.344),.265,.265,.265),o,o),ft(n,p(s(d,.398,-.02,-5.22),-.25,.25,-.25),n,p(s(d,10.055,-3.02,3.03),.3675,.3675,.3675),n,o),ft(n,p(s(d,9.25,-3,-3.035),.2,.2*.7,.2),n,p(s(d,-1,50,1),.5,.35,.5),o,o),ft(n,p(s(d,0,50,0),.5,.5,.5),n,p(s(d,0,-50,-0),.5,.5,.5),a,o),ft(n,p(s(d,0,-50,0),.5,.5,.5),n,p(s(d,0,50,0),.5,.5,.5),o,a);case 64:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ft(t,e,r,n,i,o){i=i||t,o=o||r;var a=s(h(d,Math.PI),-2,0,0),c=new rt(i,n);c.transformationMatrix=e;var f=new rt(o,u(e,a));return f.transformationMatrix=u(n,a),t.addObject(c),r.addObject(f),i&&i.addObject(c),o&&o.addObject(f),[c,f]}function ht(t,e,r){return lt.apply(this,arguments)}function lt(){return(lt=a()(i.a.mark((function t(e,r,n){var o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||1,o=new Q("textures/"+r),t.abrupt("return",fetch("objs/"+e).then((function(t){return t.text()})).then((function(t){return new W(t,o,n)})));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){st.apply(this,arguments)}()}]);
//# sourceMappingURL=bundle.js.map